<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/ruby-lsp/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/ruby-lsp/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li:not(:nth-child(1)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(1) > ul > li:nth-child(2) > ul > li:nth-child(1) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(1) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(1) > ul > li:nth-child(2) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(1) > ul > li:nth-child(2) > ul > li:nth-child(1) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list > li.nav-list-item:nth-child(1) > ul.nav-list { display: block; } </style> <script src="/ruby-lsp/assets/js/vendor/lunr.min.js"></script> <script src="/ruby-lsp/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Test explorer | Ruby LSP</title> <meta name="generator" content="Jekyll v4.4.1" /> <meta property="og:title" content="Test explorer" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="An opinionated language server for Ruby. Batteries included!" /> <meta property="og:description" content="An opinionated language server for Ruby. Batteries included!" /> <link rel="canonical" href="https://shopify.github.io/ruby-lsp/test_explorer.html" /> <meta property="og:url" content="https://shopify.github.io/ruby-lsp/test_explorer.html" /> <meta property="og:site_name" content="Ruby LSP" /> <meta property="og:image" content="https://shopify.github.io/ruby-lsp/icon.png" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary_large_image" /> <meta property="twitter:image" content="https://shopify.github.io/ruby-lsp/icon.png" /> <meta property="twitter:title" content="Test explorer" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"An opinionated language server for Ruby. Batteries included!","headline":"Test explorer","image":"https://shopify.github.io/ruby-lsp/icon.png","url":"https://shopify.github.io/ruby-lsp/test_explorer.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/ruby-lsp/" class="site-title lh-tight"> Ruby LSP </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Ruby LSP category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ruby-lsp/" class="nav-list-link">Ruby LSP</a><ul class="nav-list"><li class="nav-list-item"><a href="/ruby-lsp/editors.html" class="nav-list-link">Editors</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in VS Code extension category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ruby-lsp/vscode-extension.html" class="nav-list-link">VS Code extension</a><ul class="nav-list"><li class="nav-list-item"><a href="/ruby-lsp/test_explorer.html" class="nav-list-link">Test explorer</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Add-ons category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ruby-lsp/add-ons.html" class="nav-list-link">Add-ons</a><ul class="nav-list"><li class="nav-list-item"><a href="/ruby-lsp/test_framework_addons.html" class="nav-list-link">Test framework add-ons</a></li></ul></li><li class="nav-list-item"><a href="/ruby-lsp/design-and-roadmap.html" class="nav-list-link">Design and roadmap</a></li><li class="nav-list-item"><a href="/ruby-lsp/semantic-highlighting.html" class="nav-list-link">Semantic Highlighting for Themes</a></li><li class="nav-list-item"><a href="/ruby-lsp/composed-bundle.html" class="nav-list-link">Composed Ruby LSP bundle</a></li></ul></li><li class="nav-list-item"><a href="/ruby-lsp/rails-add-on.html" class="nav-list-link">Rails add-on</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Troubleshooting category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ruby-lsp/troubleshooting.html" class="nav-list-link">Troubleshooting</a><ul class="nav-list"><li class="nav-list-item"><a href="/ruby-lsp/version-managers.html" class="nav-list-link">Version Managers</a></li></ul></li><li class="nav-list-item"><a href="/ruby-lsp/contributing.html" class="nav-list-link">Contributing</a></li><li class="nav-list-item"><a href="/ruby-lsp/supported_versions.html" class="nav-list-link">Supported Versions Policy</a></li></ul> <ul class="nav-list"><li class="nav-list-item external"> <a href="https://github.com/Shopify/ruby-lsp" class="nav-list-link external" target="_blank" rel="noopener noreferrer" > Ruby LSP on GitHub <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li><li class="nav-list-item external"> <a href="https://github.com/Shopify/ruby-lsp-rails" class="nav-list-link external" target="_blank" rel="noopener noreferrer" > Ruby LSP Rails on GitHub <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Ruby LSP" aria-label="Search Ruby LSP" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://shopify.github.io/ruby-lsp/invite" class="site-button" > Ruby DX Slack </a> </li> <li class="aux-nav-list-item"> <a href="https://github.com/Shopify/ruby-lsp/issues/new/choose" class="site-button" > Report an Issue </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/ruby-lsp/">Ruby LSP</a></li> <li class="breadcrumb-nav-list-item"><a href="/ruby-lsp/vscode-extension.html">VS Code extension</a></li> <li class="breadcrumb-nav-list-item"><span>Test explorer</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="test-explorer"> <a href="#test-explorer" class="anchor-heading" aria-labelledby="test-explorer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Test explorer </h1> <blockquote class="important"> <p>The new test explorer implementation is currently being rolled out to users! You can adopt it early by toggling this feature flag in your user or workspace settings</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">"</span><span class="s2">rubyLsp.featureFlags</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
  <span class="dl">"</span><span class="s2">fullTestDiscovery</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre></div> </div> </blockquote> <p>The Ruby LSP implements VS Code’s <a href="https://code.visualstudio.com/docs/debugtest/testing">test explorer</a>, which allows users to execute the tests defined in their codebase in 4 modes directly from inside the editor:</p> <ul> <li>Run (default mode): runs the selected tests and displays results in the test results panel</li> <li>Run in terminal: runs the selected tests in a terminal set up by the Ruby LSP</li> <li>Debug: starts an interactive debugging session for the selected tests</li> <li>Coverage: runs tests in coverage mode and shows results inside the editor</li> </ul> <p><img src="images/test_explorer.gif" alt="Test explorer demo" /></p> <h2 id="design"> <a href="#design" class="anchor-heading" aria-labelledby="design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Design </h2> <p>Our design is based on addressing 2 main goals:</p> <ol> <li>Supporting Ruby’s diverse test frameworks without the need for extra editor extensions</li> <li>Ensuring the solution is performant enough for large scale applications</li> </ol> <p>With these in mind, the Ruby LSP populates the test explorer panel through static analysis. Loading every single test into memory to perform runtime introspection as a discovery mechanism would not satisfy our performance goal. Tests are discovered for the entire codebase automatically when:</p> <ul> <li>the user clicks one of the test related <a href="index#code-lens">code lenses</a></li> <li>the user expands the explorer</li> </ul> <p>Support for different frameworks can be provided via our <a href="add-ons">add-on API</a>, both for discovering tests and defining how to execute them. Any framework contribution made via add-ons is automatically integrated with all modes of execution. By default, the Ruby LSP supports Minitest and Test Unit. When working on Rails applications, the Rails add-on is automatically included to support the declarative syntax included by <code class="language-plaintext highlighter-rouge">ActiveSupport::TestCase</code>.</p> <p class="important">There is limited support to using multiple test frameworks in the same codebase. This use case is pretty uncommon and we will not make further investments into supporting it, in line with our design principle of <a href="design-and-roadmap#favoring-common-development-setups">favoring common setups</a></p> <p class="important">To discover all test files in the workspace with decent performance, the Ruby LSP uses a glob pattern based on conventions. For a test file to be discovered, the file path must match this glob: <code class="language-plaintext highlighter-rouge">**/{test,spec,features}/**/{*_test.rb,test_*.rb,*_spec.rb,*.feature}</code></p> <h3 id="dynamically-defined-tests"> <a href="#dynamically-defined-tests" class="anchor-heading" aria-labelledby="dynamically-defined-tests"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Dynamically defined tests </h3> <p>There is limited support for tests defined via meta-programming. Initially, they will not be present in the test explorer (as they often cannot be detected through static analysis). However, running a test file that includes dynamically defined tests will automatically populate the explorer with those tests, including the results of the execution.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Spec</span>
  <span class="c1"># These are detected automatically</span>
  <span class="n">describe</span> <span class="s2">"something"</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">"does a useful thing"</span> <span class="k">do</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># Dynamically defined tests like these are only discovered while running the entire file</span>
  <span class="p">[</span><span class="ss">:first</span><span class="p">,</span> <span class="ss">:second</span><span class="p">,</span> <span class="ss">:third</span><span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span>
    <span class="n">it</span> <span class="s2">"does the </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2"> well"</span> <span class="k">do</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Dynamically defined anonymous tests are not supported properly because there’s no way to accurately reconcile their discovery with execution.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Spec</span>
  <span class="c1"># Anonymous examples (no description) defined dynamically are not supported</span>
  <span class="mi">5</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span>
    <span class="n">it</span> <span class="k">do</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="tests-that-accept-external-parameters"> <a href="#tests-that-accept-external-parameters" class="anchor-heading" aria-labelledby="tests-that-accept-external-parameters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tests that accept external parameters </h3> <p>In Ruby, you can write tests that accept external parameters, like environment variables.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span>
  <span class="c1"># Using instance variable as an external argument</span>
  <span class="k">if</span> <span class="no">ENV</span><span class="p">[</span><span class="s2">"INCLUDE_SLOW_TESTS"</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">test_slow_operation</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># Using command line arguments to gate tests</span>
  <span class="k">if</span> <span class="no">ARGV</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="s2">"--integration-tests"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_integration</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_other_things</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Automatically detecting what type of external argument is required for each test is not trivial. Additionally, VS Code’s test explorer doesn’t have support for arguments when running tests out of the box and neither do its test items accept metadata. This scenario will not be supported by the Ruby LSP.</p> <h2 id="connecting-terminal-tests-to-the-explorer"> <a href="#connecting-terminal-tests-to-the-explorer" class="anchor-heading" aria-labelledby="connecting-terminal-tests-to-the-explorer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Connecting terminal tests to the explorer </h2> <p>When running tests in the terminal through a code lens or test explorer, the Ruby LSP and add-ons will hook up the execution commands with the expected reporters using the <code class="language-plaintext highlighter-rouge">-r</code> argument for <code class="language-plaintext highlighter-rouge">ruby</code>. You can manually hook up execution by adding the same.</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle <span class="nb">exec </span>ruby <span class="nt">-r</span>/path/to/ruby-lsp/reporter <span class="nt">-Itest</span> <span class="nb">test</span>/example_test.rb
bundle <span class="nb">exec </span>ruby <span class="nt">-r</span>/path/to/ruby-lsp/reporter <span class="nt">-Ispec</span> spec/example_spec.rb
</code></pre></div></div> <h2 id="customization"> <a href="#customization" class="anchor-heading" aria-labelledby="customization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Customization </h2> <p>When tests are running through any execution mode, we set the <code class="language-plaintext highlighter-rouge">RUBY_LSP_TEST_RUNNER</code> environment variable to allow users to customize behavior of their test suite if needed.</p> <p class="important">Using coverage mode <strong>does not require any extra dependencies or configuration</strong> for collecting the coverage data. This is done automatically by the Ruby LSP through Ruby’s built-in coverage API.</p> <p>Users can also differentiate between the mode of execution, which is the value of the <code class="language-plaintext highlighter-rouge">RUBY_LSP_TEST_RUNNER</code> variable:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># test/test_helper.rb</span>

<span class="k">case</span> <span class="no">ENV</span><span class="p">[</span><span class="s2">"RUBY_LSP_TEST_RUNNER"</span><span class="p">]</span>
<span class="k">when</span> <span class="s2">"run"</span>
  <span class="c1"># Do something when using run or run in terminal modes</span>
<span class="k">when</span> <span class="s2">"debug"</span>
  <span class="c1"># Do something when using debug mode</span>
<span class="k">when</span> <span class="s2">"coverage"</span>
  <span class="c1"># Do something when using coverage mode</span>
<span class="k">else</span>
  <span class="c1"># Do something when running outside of the context of the Ruby LSP integration</span>
<span class="k">end</span>
</code></pre></div></div> <h2 id="other-editors"> <a href="#other-editors" class="anchor-heading" aria-labelledby="other-editors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Other editors </h2> <p>The test explorer functionality is not yet standardized as part of the <a href="https://microsoft.github.io/language-server-protocol/specification">language server specification</a>, which means that it cannot be used by other editors without custom extension code to integrate all of the pieces together.</p> <p>As most of the implementation is on server side, if any editor supports similar UI elements and editor-side APIs (either directly or through plugins), it can integrate this feature as well. Below are the custom request specifications.</p> <h3 id="discover-tests"> <a href="#discover-tests" class="anchor-heading" aria-labelledby="discover-tests"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Discover tests </h3> <p>This request is sent by the client to discover which test items exist for a given text document URI.</p> <p>Server capability: <code class="language-plaintext highlighter-rouge">capabilities.experimental.full_test_discovery</code></p> <p>Method: <code class="language-plaintext highlighter-rouge">rubyLsp/discoverTests</code></p> <p>Params:</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">DiscoverTestParams</span> <span class="p">{</span>
  <span class="nl">textDocument</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">uri</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div> <p>Response:</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Matches vscode.TestItem with some minor modifications</span>
<span class="kr">interface</span> <span class="nx">TestItem</span> <span class="p">{</span>
  <span class="nl">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">label</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">uri</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">range</span><span class="p">:</span> <span class="p">{</span> <span class="na">start</span><span class="p">:</span> <span class="p">{</span> <span class="na">line</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span> <span class="nl">character</span><span class="p">:</span> <span class="kr">number</span> <span class="p">},</span> <span class="na">end</span><span class="p">:</span> <span class="p">{</span> <span class="na">line</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span> <span class="nl">character</span><span class="p">:</span> <span class="kr">number</span> <span class="p">}};</span>
  <span class="nl">tags</span><span class="p">:</span> <span class="kr">string</span><span class="p">[];</span>
  <span class="nl">children</span><span class="p">:</span> <span class="nx">TestItem</span><span class="p">[];</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Response</span> <span class="o">=</span> <span class="nx">TestItem</span><span class="p">[];</span>
</code></pre></div></div> <h3 id="resolve-test-commands"> <a href="#resolve-test-commands" class="anchor-heading" aria-labelledby="resolve-test-commands"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Resolve test commands </h3> <p>This request is sent by the client for the server to determine the minimum number of commands required to execute a given hierarchy of tests. For example, if we execute a test group (class) inside of the bar_test.rb file and 3 examples inside of the <code class="language-plaintext highlighter-rouge">foo_test.rb</code> file, the minimum required commands to execute them may look like this:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span>
  <span class="s2">"bin/rails test test/foo_test.rb:13:25:40"</span><span class="p">,</span>
  <span class="s2">"bin/rails test test/bar_test.rb --name </span><span class="se">\"</span><span class="s2">/^BarTest::NestedTest(#|::)/</span><span class="se">\"</span><span class="s2">"</span>
<span class="p">]</span>
</code></pre></div></div> <p>Server capability: <code class="language-plaintext highlighter-rouge">capabilities.experimental.full_test_discovery</code></p> <p>Method: <code class="language-plaintext highlighter-rouge">rubyLsp/resolveTestCommands</code></p> <p>Params:</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">type</span> <span class="nx">Params</span> <span class="o">=</span> <span class="nx">TestItem</span><span class="p">[];</span>
</code></pre></div></div> <p>Response:</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">ResolveTestCommandsResult</span> <span class="p">{</span>
  <span class="c1">// The array of commands required to execute the tests</span>
  <span class="nl">commands</span><span class="p">:</span> <span class="kr">string</span><span class="p">[];</span>

  <span class="c1">// An optional array of custom LSP test reporters. Used to stream test results to the client side using JSON RPC</span>
  <span class="c1">// messages</span>
  <span class="nl">reporterPaths</span><span class="p">?:</span> <span class="kr">string</span><span class="p">[];</span>
<span class="p">}</span>
</code></pre></div></div> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
