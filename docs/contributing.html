<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/ruby-lsp/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/ruby-lsp/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li:not(:nth-child(4)) > a, .site-nav > ul.nav-list:first-child > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(4) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(4) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list { display: block; } </style> <script src="/ruby-lsp/assets/js/vendor/lunr.min.js"></script> <script src="/ruby-lsp/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Contributing | Ruby LSP</title> <meta name="generator" content="Jekyll v4.4.1" /> <meta property="og:title" content="Contributing" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="An opinionated language server for Ruby. Batteries included!" /> <meta property="og:description" content="An opinionated language server for Ruby. Batteries included!" /> <link rel="canonical" href="https://shopify.github.io/ruby-lsp/contributing.html" /> <meta property="og:url" content="https://shopify.github.io/ruby-lsp/contributing.html" /> <meta property="og:site_name" content="Ruby LSP" /> <meta property="og:image" content="https://shopify.github.io/ruby-lsp/icon.png" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary_large_image" /> <meta property="twitter:image" content="https://shopify.github.io/ruby-lsp/icon.png" /> <meta property="twitter:title" content="Contributing" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"An opinionated language server for Ruby. Batteries included!","headline":"Contributing","image":"https://shopify.github.io/ruby-lsp/icon.png","url":"https://shopify.github.io/ruby-lsp/contributing.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/ruby-lsp/" class="site-title lh-tight"> Ruby LSP </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Ruby LSP category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ruby-lsp/" class="nav-list-link">Ruby LSP</a><ul class="nav-list"><li class="nav-list-item"><a href="/ruby-lsp/editors.html" class="nav-list-link">Editors</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in VS Code extension category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ruby-lsp/vscode-extension.html" class="nav-list-link">VS Code extension</a><ul class="nav-list"><li class="nav-list-item"><a href="/ruby-lsp/test_explorer.html" class="nav-list-link">Test explorer</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Add-ons category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ruby-lsp/add-ons.html" class="nav-list-link">Add-ons</a><ul class="nav-list"><li class="nav-list-item"><a href="/ruby-lsp/test_framework_addons.html" class="nav-list-link">Test framework add-ons</a></li></ul></li><li class="nav-list-item"><a href="/ruby-lsp/design-and-roadmap.html" class="nav-list-link">Design and roadmap</a></li><li class="nav-list-item"><a href="/ruby-lsp/semantic-highlighting.html" class="nav-list-link">Semantic Highlighting for Themes</a></li><li class="nav-list-item"><a href="/ruby-lsp/composed-bundle.html" class="nav-list-link">Composed Ruby LSP bundle</a></li></ul></li><li class="nav-list-item"><a href="/ruby-lsp/rails-add-on.html" class="nav-list-link">Rails add-on</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Troubleshooting category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ruby-lsp/troubleshooting.html" class="nav-list-link">Troubleshooting</a><ul class="nav-list"><li class="nav-list-item"><a href="/ruby-lsp/version-managers.html" class="nav-list-link">Version Managers</a></li></ul></li><li class="nav-list-item"><a href="/ruby-lsp/contributing.html" class="nav-list-link">Contributing</a></li><li class="nav-list-item"><a href="/ruby-lsp/supported_versions.html" class="nav-list-link">Supported Versions Policy</a></li></ul> <ul class="nav-list"><li class="nav-list-item external"> <a href="https://github.com/Shopify/ruby-lsp" class="nav-list-link external" target="_blank" rel="noopener noreferrer" > Ruby LSP on GitHub <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li><li class="nav-list-item external"> <a href="https://github.com/Shopify/ruby-lsp-rails" class="nav-list-link external" target="_blank" rel="noopener noreferrer" > Ruby LSP Rails on GitHub <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Ruby LSP" aria-label="Search Ruby LSP" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://shopify.github.io/ruby-lsp/invite" class="site-button" > Ruby DX Slack </a> </li> <li class="aux-nav-list-item"> <a href="https://github.com/Shopify/ruby-lsp/issues/new/choose" class="site-button" > Report an Issue </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 id="contributing"> <a href="#contributing" class="anchor-heading" aria-labelledby="contributing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Contributing </h1> <blockquote class="note"> <p>If you plan to invest significant effort into a large pull request with multiple decisions that may impact the long term maintenance of the Ruby LSP, please open a <a href="https://github.com/Shopify/ruby-lsp/discussions/new/choose">discussion</a> first to align on the direction.</p> </blockquote> <p>The <a href="https://github.com/Shopify/ruby-lsp">ruby-lsp repository</a> contains three sub-projects:</p> <ul> <li>the <strong>language server</strong> (<code class="language-plaintext highlighter-rouge">ruby-lsp</code>), which exists at the top level of the repository. Most features are implemented here since everything implemented in the server is available to all editors</li> <li>the <strong>VS Code extension</strong>, which exists under the <code class="language-plaintext highlighter-rouge">vscode</code> directory. Any custom VS Code features are implemented here</li> <li>the <strong>documentation</strong> website, which exists under the <code class="language-plaintext highlighter-rouge">jekyll</code> directory. All user facing documentation for both the Ruby LSP and the Rails add-on is contained here</li> </ul> <p>This contributing guide is split by each component.</p> <h2 id="initial-setup"> <a href="#initial-setup" class="anchor-heading" aria-labelledby="initial-setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Initial setup </h2> <p>To start contributing to the Ruby LSP, ensure that all dependencies are installed as follows:</p> <ul> <li><code class="language-plaintext highlighter-rouge">bundle install</code> on the top level will install Ruby dependencies</li> <li><code class="language-plaintext highlighter-rouge">bundle install</code> in the <code class="language-plaintext highlighter-rouge">jekyll</code> directory will install documentation dependencies</li> <li><code class="language-plaintext highlighter-rouge">yarn install</code> in the <code class="language-plaintext highlighter-rouge">vscode</code> directory will install Node.js dependencies for the VS Code extension</li> </ul> <h2 id="contributing-to-the-server"> <a href="#contributing-to-the-server" class="anchor-heading" aria-labelledby="contributing-to-the-server"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Contributing to the server </h2> <p>This is the structure of the <code class="language-plaintext highlighter-rouge">ruby-lsp</code> gem:</p> <ul> <li><code class="language-plaintext highlighter-rouge">lib/ruby_indexer</code>: the code indexer to extract declarations from the workspace</li> <li><code class="language-plaintext highlighter-rouge">lib/ruby_lsp/*.rb</code>: foundational pieces of the language server, such as workers, queues, handling requests and so on</li> <li><code class="language-plaintext highlighter-rouge">lib/ruby_lsp/requests</code>: request implementation. These match one to one with the <a href="https://microsoft.github.io/language-server-protocol/specification">language server specification</a></li> <li><code class="language-plaintext highlighter-rouge">lib/ruby_lsp/listeners</code>: Prism dispatcher listeners. Most of the server’s infrastructure relies on a listener pattern to maximize performance while traversing ASTs. Note that a single request may depend on more than one listener</li> </ul> <p>When adding or changing an existing feature, first identify which request is responsible for it in the <a href="https://microsoft.github.io/language-server-protocol/specification">specification</a>. Then identify which file in the server implements that request and start thinking about the implementation.</p> <p class="note">When using VS Code, open the <code class="language-plaintext highlighter-rouge">ruby-lsp.code-workspace</code> file instead of just opening the regular folder. It contains configurations for working with the sub projects side by side effectively.</p> <h3 id="debugging"> <a href="#debugging" class="anchor-heading" aria-labelledby="debugging"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Debugging </h3> <h4 id="live-debugging-the-server"> <a href="#live-debugging-the-server" class="anchor-heading" aria-labelledby="live-debugging-the-server"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Live debugging the server </h4> <p>It is possible to live debug the development instance of the language server that is currently running when using VS Code:</p> <ol> <li><code class="language-plaintext highlighter-rouge">CMD/CTRL + SHIFT + P</code> to open the command palette</li> <li>Search for <code class="language-plaintext highlighter-rouge">Debug the Ruby LSP server</code>. This command will restart the server in debug mode, allowing you to connect with a debugger. Note that the debug mode applies only until the editor is closed or Ruby LSP restarts</li> <li>After the server has launched in debug mode, attach the debugger by going in <code class="language-plaintext highlighter-rouge">Run and debug</code>, selecting the <code class="language-plaintext highlighter-rouge">Attach to existing server</code> task and clicking run</li> <li>You should now be able to put breakpoints in the UI and triggering requests will stop at those breakpoints</li> </ol> <p>Caveat: since you are debugging the language server instance that is currently running in your own editor, features will not be available if the execution is currently suspended at a breakpoint.</p> <h4 id="understanding-prism-asts"> <a href="#understanding-prism-asts" class="anchor-heading" aria-labelledby="understanding-prism-asts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Understanding Prism ASTs </h4> <p>The Ruby LSP uses Prism to parse and understand Ruby code. When working on a feature, it’s very common to need to inspect the structure of the Prism AST for a given code snippet, so that you can understand why a request is being triggered a certain way.</p> <p>If you’re using VS Code, you can use the <a href="https://shopify.github.io/ruby-lsp/#show-syntax-tree">show syntax tree command</a> to inspect the structure of an AST for an entire document or selection.</p> <p>For other editors, using our IRB configurations is the easiest way of achieving the same:</p> <ol> <li><code class="language-plaintext highlighter-rouge">bundle exec irb</code> to launch IRB with our configurations. It will require all libraries for you</li> <li>Then parse the Ruby code you’d like to understand better and start inspecting</li> </ol> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">source</span> <span class="o">=</span> <span class="o">&lt;&lt;~</span><span class="no">RUBY</span><span class="sh">
  class Foo
    def bar
    end
  end
</span><span class="no">RUBY</span>

<span class="n">ast</span> <span class="o">=</span> <span class="no">Prism</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">source</span><span class="p">).</span><span class="nf">value</span>
</code></pre></div></div> <p>Check the <a href="https://ruby.github.io/prism/">Prism documentation</a> for more related information.</p> <h4 id="tracing-lsp-requests-and-responses"> <a href="#tracing-lsp-requests-and-responses" class="anchor-heading" aria-labelledby="tracing-lsp-requests-and-responses"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tracing LSP requests and responses </h4> <p>In VS Code, you can verify what’s happening in the server by enabling tracing, which allows for different levels of logging.</p> <div class="language-jsonc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="c1">// Your JSON settings</span><span class="w">
  </span><span class="c1">//</span><span class="w">
  </span><span class="c1">// - `off`: no tracing</span><span class="w">
  </span><span class="c1">// - `messages`: display requests and responses notifications</span><span class="w">
  </span><span class="c1">// - `verbose`: display each request and response as JSON</span><span class="w">
  </span><span class="nl">"ruby lsp.trace.server"</span><span class="p">:</span><span class="w"> </span><span class="s2">"messages"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h4 id="manually-testing-a-change"> <a href="#manually-testing-a-change" class="anchor-heading" aria-labelledby="manually-testing-a-change"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Manually testing a change </h4> <p>After you made a change or added a new feature, you can verify it in the editor by restarting the language server. In VS Code, this can be achieved by running the command <code class="language-plaintext highlighter-rouge">Ruby LSP: restart</code>, which will reboot the server and pick up your changes.</p> <p>For other editors, you must manually restart the language server to pick up the latest changes.</p> <h4 id="debugging-tests"> <a href="#debugging-tests" class="anchor-heading" aria-labelledby="debugging-tests"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Debugging tests </h4> <p>In VS Code, we recommend:</p> <ol> <li>Setting breakpoints in the UI</li> <li>Opening the test that will hit that breakpoint</li> <li>Clicking the <code class="language-plaintext highlighter-rouge">debug</code> code lens button on top of examples</li> </ol> <p>Alternatively (and for other editors), adding a <code class="language-plaintext highlighter-rouge">binding.b</code> statement in the code and executing the test in the terminal will also allow you to debug the code.</p> <h3 id="writing-tests"> <a href="#writing-tests" class="anchor-heading" aria-labelledby="writing-tests"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Writing tests </h3> <p>There are two types of tests in the Ruby LSP. The first type is likely familiar: standard Minitest files with a bunch of examples inside using the method declaration syntax.</p> <p>The second type of test is our fixture/expectation framework. Adding a new fixture under <code class="language-plaintext highlighter-rouge">test/fixtures</code> will automatically make the framework run all requests against that fixture. By default, the framework only checks that the features don’t crash when running against the fixture. This is useful for ensuring that critical requests don’t break when using less common Ruby syntax.</p> <p>To go beyond checking if the requests break for a fixture, you can add an expectation to <code class="language-plaintext highlighter-rouge">test/expectations/NAME_OF_THE_REQUEST</code>, which allows you to assert the expected response for a request and fixture combination.</p> <p>For example, if we have a <code class="language-plaintext highlighter-rouge">test/fixtures/foo.rb</code>, then adding a <code class="language-plaintext highlighter-rouge">test/expectations/semantic_highlighting/foo.exp.json</code> will make the framework verify that when running semantic highlighting in the <code class="language-plaintext highlighter-rouge">foo.rb</code> fixture, the <code class="language-plaintext highlighter-rouge">foo.exp.json</code> response is expected.</p> <p>Check existing fixture and expectation combinations for examples.</p> <h4 id="when-to-use-each-type-of-test"> <a href="#when-to-use-each-type-of-test" class="anchor-heading" aria-labelledby="when-to-use-each-type-of-test"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> When to use each type of test </h4> <p>The fixture/expectation framework is intended to be used mostly by full document requests (language server features that are computed for the entire file every time).</p> <p>Requests and features that are position specific or that operate under a different mechanism should just use regular Minitest tests.</p> <h4 id="running-the-test-suite"> <a href="#running-the-test-suite" class="anchor-heading" aria-labelledby="running-the-test-suite"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Running the test suite </h4> <p>There are multiple ways to execute tests available.</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run the entire test suite</span>
bundle <span class="nb">exec </span>rake

<span class="c"># Run only indexing tests</span>
bundle <span class="nb">exec </span>rake <span class="nb">test</span>:indexer

<span class="c"># Run only language server tests (excluding indexing)</span>
bundle <span class="nb">exec </span>rake <span class="nb">test</span>

<span class="c"># Using the custom test framework to run a specific fixture example</span>
<span class="c"># bin/test test/requests/the_request_you_want_to_run_test.rb name_of_fixture</span>
bin/test <span class="nb">test</span>/requests/diagnostics_expectations_test.rb def_bad_formatting
</code></pre></div></div> <p>Additionally, we use RuboCop for linting and Sorbet for type checking.</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run linting</span>
bundle <span class="nb">exec </span>rubocop

<span class="c"># Run type checking</span>
bundle <span class="nb">exec </span>srb tc
</code></pre></div></div> <h2 id="contributing-to-the-vs-code-extension"> <a href="#contributing-to-the-vs-code-extension" class="anchor-heading" aria-labelledby="contributing-to-the-vs-code-extension"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Contributing to the VS Code extension </h2> <p>Before starting on this section, ensure that <a href="#initial-setup">dependencies are installed</a>.</p> <p>In addition to what’s described here, the <a href="https://code.visualstudio.com/api">VS Code extension API documentation</a> is a great place to gather more context about how extensions interact with the editor.</p> <p>The VS Code extension currently has the following main parts:</p> <ul> <li>Version manager integrations for Ruby environment activation</li> <li>A <a href="https://github.com/ruby/debug">ruby/debug</a> client implementation</li> <li>A <a href="https://code.visualstudio.com/docs/editor/testing">test controller</a> implementation</li> <li>A <a href="https://code.visualstudio.com/api/extension-guides/chat">Copilot chat participant</a></li> <li>A dependencies tree implementation</li> <li>The LSP client</li> <li>A workspace abstraction to represent each active workspace in the editor</li> </ul> <h3 id="testing-changes"> <a href="#testing-changes" class="anchor-heading" aria-labelledby="testing-changes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Testing changes </h3> <p class="note">Open the <code class="language-plaintext highlighter-rouge">ruby-lsp.code-workspace</code> file instead of just opening the regular folder. It contains contains the configuration needed for using ‘Run and debug’ as described below.</p> <p>We try to ensure thorough testing as much as possible. However, some tests are difficult to write, in particular those that interact with VS Code widgets.</p> <p>For example, if running the test displays a dialog, the test has no easy way of clicking a button on it to continue execution. For these situations we use <code class="language-plaintext highlighter-rouge">sinon</code> to stub expected invocations and responses.</p> <p>Note: <code class="language-plaintext highlighter-rouge">client.test.ts</code> is an integration style test that boots the development version of the <code class="language-plaintext highlighter-rouge">ruby-lsp</code> gem and runs requests against it.</p> <h4 id="running-tests"> <a href="#running-tests" class="anchor-heading" aria-labelledby="running-tests"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Running tests </h4> <p>The easiest way to run tests is by selecting the <code class="language-plaintext highlighter-rouge">Extension tests</code> task in <code class="language-plaintext highlighter-rouge">Run and debug</code> and clicking run. That will run all tests and the results will appear in VS Code’s debug console.</p> <p>Alternatively, you can also run the tests through the terminal, which will download a test VS Code version inside the repository and run tests against it. You can avoid the download by running the tests through the launch task.</p> <p>Note: it is not possible to run a single test file or example.</p> <h3 id="live-debugging"> <a href="#live-debugging" class="anchor-heading" aria-labelledby="live-debugging"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Live debugging </h3> <p>It is possible to live debug the development version of the extension. Detailed information can be found in the <a href="(https://code.visualstudio.com/api)">VS Code extension documentation</a>, but this section includes a short description.</p> <p>Live debugging involves two VS Code windows. The first one is where you will be modifying the code and the second window will be where the development version of the extension is going to be running. You want to change the code in the first window, reload and verify the changes in the second window.</p> <ol> <li>Start by launching the extension debugging with the <code class="language-plaintext highlighter-rouge">Run extension</code> task in the <code class="language-plaintext highlighter-rouge">Run and debug</code> panel. This will open the second VS Code window where the development version of the extension is running</li> <li>Make the desired changes in the first original VS Code window</li> <li>Click the reload button in the <a href="https://code.visualstudio.com/Docs/editor/debugging#_user-interface">debug toolbar</a> to load your recent changes into the second VS Code window</li> <li>Perform the actions to verify your changes in the second window</li> </ol> <p>If you wish to perform step by step debugging, all you have to do is add breakpoints through the UI in the first window where you are modifying the code - not in the second window where the development version of the extension is running.</p> <h2 id="contributing-to-documentation"> <a href="#contributing-to-documentation" class="anchor-heading" aria-labelledby="contributing-to-documentation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Contributing to documentation </h2> <p>The Ruby LSP uses <a href="https://jekyllrb.com/">Jekyll</a> to generate the documentation, whose source lives under the <code class="language-plaintext highlighter-rouge">/jekyll</code> folder. Before making any changes, ensure you <a href="#initial-setup">performed initial setup</a>.</p> <p>After that, follow these steps to make and verify your changes:</p> <ol> <li>Make the desired changes</li> <li>Launch jekyll in development <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle <span class="nb">exec </span>jekyll serve
</code></pre></div> </div> </li> <li>Verify your changes locally by visiting <a href="http://localhost:4000/ruby-lsp">http://localhost:4000/ruby-lsp</a></li> </ol> <h2 id="contributing-to-the-ruby-lsp-rails-add-on"> <a href="#contributing-to-the-ruby-lsp-rails-add-on" class="anchor-heading" aria-labelledby="contributing-to-the-ruby-lsp-rails-add-on"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Contributing to the Ruby LSP Rails add-on </h2> <p>See <a href="https://github.com/Shopify/ruby-lsp-rails/blob/main/CONTRIBUTING.md">https://github.com/Shopify/ruby-lsp-rails/blob/main/CONTRIBUTING.md</a></p> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
