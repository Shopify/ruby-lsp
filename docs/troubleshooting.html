<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/ruby-lsp/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/ruby-lsp/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li:not(:nth-child(3)) > a, .site-nav > ul.nav-list:first-child > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(3) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(3) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(3) > ul.nav-list { display: block; } </style> <script src="/ruby-lsp/assets/js/vendor/lunr.min.js"></script> <script src="/ruby-lsp/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Troubleshooting | Ruby LSP</title> <meta name="generator" content="Jekyll v4.4.1" /> <meta property="og:title" content="Troubleshooting" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="An opinionated language server for Ruby. Batteries included!" /> <meta property="og:description" content="An opinionated language server for Ruby. Batteries included!" /> <link rel="canonical" href="https://shopify.github.io/ruby-lsp/troubleshooting.html" /> <meta property="og:url" content="https://shopify.github.io/ruby-lsp/troubleshooting.html" /> <meta property="og:site_name" content="Ruby LSP" /> <meta property="og:image" content="https://shopify.github.io/ruby-lsp/icon.png" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary_large_image" /> <meta property="twitter:image" content="https://shopify.github.io/ruby-lsp/icon.png" /> <meta property="twitter:title" content="Troubleshooting" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"An opinionated language server for Ruby. Batteries included!","headline":"Troubleshooting","image":"https://shopify.github.io/ruby-lsp/icon.png","url":"https://shopify.github.io/ruby-lsp/troubleshooting.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <header class="side-bar"> <div class="site-header"> <a href="/ruby-lsp/" class="site-title lh-tight"> Ruby LSP </a> <button id="menu-button" class="site-button btn-reset" aria-label="Menu" aria-expanded="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Ruby LSP submenu" aria-expanded="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ruby-lsp/" class="nav-list-link">Ruby LSP</a><ul class="nav-list"><li class="nav-list-item"><a href="/ruby-lsp/editors.html" class="nav-list-link">Editors</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="VS Code extension submenu" aria-expanded="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ruby-lsp/vscode-extension.html" class="nav-list-link">VS Code extension</a><ul class="nav-list"><li class="nav-list-item"><a href="/ruby-lsp/test_explorer.html" class="nav-list-link">Test explorer</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Add-ons submenu" aria-expanded="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ruby-lsp/add-ons.html" class="nav-list-link">Add-ons</a><ul class="nav-list"><li class="nav-list-item"><a href="/ruby-lsp/test_framework_addons.html" class="nav-list-link">Test framework add-ons</a></li></ul></li><li class="nav-list-item"><a href="/ruby-lsp/design-and-roadmap.html" class="nav-list-link">Design and roadmap</a></li><li class="nav-list-item"><a href="/ruby-lsp/semantic-highlighting.html" class="nav-list-link">Semantic Highlighting for Themes</a></li><li class="nav-list-item"><a href="/ruby-lsp/composed-bundle.html" class="nav-list-link">Composed Ruby LSP bundle</a></li></ul></li><li class="nav-list-item"><a href="/ruby-lsp/rails-add-on.html" class="nav-list-link">Rails add-on</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Troubleshooting submenu" aria-expanded="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/ruby-lsp/troubleshooting.html" class="nav-list-link">Troubleshooting</a><ul class="nav-list"><li class="nav-list-item"><a href="/ruby-lsp/version-managers.html" class="nav-list-link">Version Managers</a></li></ul></li><li class="nav-list-item"><a href="/ruby-lsp/security.html" class="nav-list-link">Security</a></li><li class="nav-list-item"><a href="/ruby-lsp/contributing.html" class="nav-list-link">Contributing</a></li><li class="nav-list-item"><a href="/ruby-lsp/supported_versions.html" class="nav-list-link">Supported Versions Policy</a></li></ul> <ul class="nav-list"><li class="nav-list-item external"> <a href="https://github.com/Shopify/ruby-lsp" class="nav-list-link external" target="_blank" rel="noopener noreferrer" > Ruby LSP on GitHub <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li><li class="nav-list-item external"> <a href="https://github.com/Shopify/ruby-lsp-rails" class="nav-list-link external" target="_blank" rel="noopener noreferrer" > Ruby LSP Rails on GitHub <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li></ul> </nav> <div class="d-md-block d-none site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </div> </header> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Ruby LSP" autocomplete="off"> <label for="search-input" class="search-label"> <span class="sr-only">Search Ruby LSP</span> <svg viewBox="0 0 24 24" class="search-icon" aria-hidden="true"><use xlink:href="#svg-search"></use></svg> </label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://shopify.github.io/ruby-lsp/invite" class="site-button" > Ruby DX Slack </a> </li> <li class="aux-nav-list-item"> <a href="https://github.com/Shopify/ruby-lsp/issues/new/choose" class="site-button" > Report an Issue </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 id="troubleshooting"> <a href="#troubleshooting" class="anchor-heading" aria-labelledby="troubleshooting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Troubleshooting </h1> <h2 id="how-the-ruby-lsp-activation-works"> <a href="#how-the-ruby-lsp-activation-works" class="anchor-heading" aria-labelledby="how-the-ruby-lsp-activation-works"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How the Ruby LSP activation works </h2> <p>The Ruby LSP extension runs inside VS Code’s NodeJS runtime, like any other VS Code extension. This means that environment variables that are properly set in your shell may not exist inside the NodeJS process. To run the LSP server with the same Ruby version as your projects, we need to properly set these environment variables, which is done by invoking your Ruby version manager.</p> <p>The extension runs a command using your shell’s interactive mode, so that version managers configured in files such as <code class="language-plaintext highlighter-rouge">~/.zshrc</code> are picked up automatically. The command then exports the environment information into JSON, so that we can inject it into the NodeJS process and appropriately set the Ruby version and gem installation paths.</p> <p>As an example, the activation script for <code class="language-plaintext highlighter-rouge">zsh</code> using <code class="language-plaintext highlighter-rouge">rbenv</code> as a version manager will look something like this:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Invoke zsh using interactive mode (loads ~/.zshrc) to run a single command</span>
<span class="c"># The command is `rbenv exec ruby`, which automatically sets all relevant environment variables and selects the</span>
<span class="c"># specified Ruby version</span>
<span class="c"># We then print the activated environment as JSON. We read that JSON from the NodeJS process to insert the needed</span>
<span class="c"># environment variables in order to run Ruby correctly</span>
/bin/zsh <span class="nt">-ic</span> <span class="s1">'rbenv exec ruby -rjson -e "puts JSON.dump(ENV.to_h)"'</span>
</code></pre></div></div> <p>After activating the Ruby version, we then proceed to boot the server gem (<code class="language-plaintext highlighter-rouge">ruby-lsp</code>). To avoid having users include the <code class="language-plaintext highlighter-rouge">ruby-lsp</code> in their <code class="language-plaintext highlighter-rouge">Gemfile</code>, we create a <a href="composed-bundle">composed bundle</a> under the <code class="language-plaintext highlighter-rouge">.ruby-lsp</code> directory inside your project.</p> <h2 id="common-issues"> <a href="#common-issues" class="anchor-heading" aria-labelledby="common-issues"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Common issues </h2> <p>There are several main sources of issues users typically face during activation: outdated version, shell problems, or Bundler related problems.</p> <h3 id="outdated-version"> <a href="#outdated-version" class="anchor-heading" aria-labelledby="outdated-version"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Outdated Version </h3> <blockquote class="note"> <p>If using VS Code, the version of the extension is distinct from that of the server (the <code class="language-plaintext highlighter-rouge">ruby-lsp</code> gem). You can check the server version in the <a href="https://github.com/Shopify/ruby-lsp/blob/main/vscode/extras/ruby_lsp_status_center.png">status center</a>.</p> </blockquote> <p>In most cases, the server gem will be automatically updated. You can also trigger a manual update with the “Update language server gem” command in VS Code.</p> <p>You can also attempt an update from the command line with <code class="language-plaintext highlighter-rouge">BUNDLE_GEMFILE=.ruby-lsp/Gemfile bundle update ruby-lsp</code></p> <p class="note">If you’re using any add-on gem, such as <code class="language-plaintext highlighter-rouge">ruby-lsp-rspec</code>, then <code class="language-plaintext highlighter-rouge">ruby-lsp</code> will also be present in your <code class="language-plaintext highlighter-rouge">Gemfile.lock</code> and it’s possible that an outdated add-on could prevent <code class="language-plaintext highlighter-rouge">ruby-lsp</code> from updating.</p> <p>Another possible scenario where the <code class="language-plaintext highlighter-rouge">ruby-lsp</code> gem cannot be updated is when one of its runtime dependencies are constrained by another gem in the application. For example, Ruby LSP has a dependency on <a href="https://github.com/ruby/rbs">RBS</a> v3. If another gem constrains the version of RBS to an older release, it will not be possible to use newer versions of Ruby LSP.</p> <p>The 3 runtime dependencies of the Ruby LSP are <code class="language-plaintext highlighter-rouge">rbs</code>, <code class="language-plaintext highlighter-rouge">prism</code> and <code class="language-plaintext highlighter-rouge">sorbet-runtime</code>. If any of them are being constrained by the application, the Ruby LSP may fail to update.</p> <p>Running <code class="language-plaintext highlighter-rouge">BUNDLE_GEMFILE=.ruby-lsp/Gemfile bundle outdated</code> may help with understanding what is being constrained.</p> <h3 id="shell-issues"> <a href="#shell-issues" class="anchor-heading" aria-labelledby="shell-issues"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Shell issues </h3> <p>When the extension invokes the shell and loads its config file (<code class="language-plaintext highlighter-rouge">~/.zshrc</code>, <code class="language-plaintext highlighter-rouge">~/.bashrc</code>, etc), it is susceptible to issues that may be caused by how the shell or its plugins interact with the NodeJS process. For example</p> <ul> <li>Some plugins completely redirect the stderr pipe to implement their functionality (fixed on the Ruby LSP side by https://github.com/Shopify/vscode-ruby-lsp/pull/918)</li> <li>Some plugins fail immediately or end up in an endless loop if they detect there’s no UI attached to the shell process. In this case, it’s not possible to fix from the Ruby LSP side since a shell invoked by NodeJS will never have a UI</li> </ul> <p>Additionally, some users experience an issue where VS Code selects the wrong shell, not respecting the <code class="language-plaintext highlighter-rouge">SHELL</code> environment variable. This usually ends up in having <code class="language-plaintext highlighter-rouge">/bin/sh</code> selected instead of your actual shell. If you are facing this problem, please try to</p> <ul> <li>Update VS Code to the latest version</li> <li>Completely close VS Code and launch it from the terminal with <code class="language-plaintext highlighter-rouge">code .</code> (instead of opening VS Code from the launch icon)</li> </ul> <p>More context about this issue on https://github.com/Shopify/vscode-ruby-lsp/issues/901.</p> <h3 id="bundler-issues"> <a href="#bundler-issues" class="anchor-heading" aria-labelledby="bundler-issues"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Bundler issues </h3> <p>Firstly, ensure you are using the latest release of Bundler (run <code class="language-plaintext highlighter-rouge">bundle update --bundler</code>).</p> <p>If the extension successfully activated the Ruby environment, it may still fail when trying to compose the composed bundle to run the server gem. This could be a regular Bundler issue, like not being able to satisfy dependencies due to a conflicting version requirement, or it could be a configuration issue.</p> <p>For example, if the project has its linter/formatter put in an optional <code class="language-plaintext highlighter-rouge">Gemfile</code> group and that group is excluded in the Bundler configuration, the Ruby LSP will not be able to see those gems.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Gemfile</span>

<span class="c1"># ...</span>

<span class="c1"># If Bundler is configured to exclude this group, the Ruby LSP will not be able to find `rubocop`</span>
<span class="n">group</span> <span class="ss">:optional_group</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s2">"rubocop"</span>
<span class="k">end</span>
</code></pre></div></div> <p>If you experience Bundler related issues, double-check both your global and project-specific configuration to check if there’s anything that could be preventing the server from booting. You can print your Bundler configuration with</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle config
</code></pre></div></div> <h3 id="format-on-save-dialogue-wont-disappear"> <a href="#format-on-save-dialogue-wont-disappear" class="anchor-heading" aria-labelledby="format-on-save-dialogue-wont-disappear"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Format on save dialogue won’t disappear </h3> <p>When VS Code requests formatting for a document, it opens a dialogue showing progress a couple of seconds after sending the request, closing it once the server has responded with the formatting result.</p> <p>If you are seeing that the dialogue is not going away, this likely doesn’t mean that formatting is taking very long or hanging. It likely means that the server crashed or got into a corrupt state and is simply not responding to any requests, which means the dialogue will never go away.</p> <p>This is always the result of a bug in the server. It should always fail gracefully without getting into a corrupt state that prevents it from responding to new requests coming from the editor. If you encounter this, please submit a bug report <a href="https://github.com/Shopify/ruby-lsp/issues/new/choose">here</a> including the steps that led to the server getting stuck.</p> <h3 id="missing-features"> <a href="#missing-features" class="anchor-heading" aria-labelledby="missing-features"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Missing Features </h3> <p>If you find that some features are working (such as formatting), but others aren’t (such as go to definition), and are working on a codebase that uses Sorbet, then this may indicate the <a href="https://sorbet.org/docs/lsp#instructions-for-specific-language-clients">Sorbet LSP isn’t running</a>. To avoid duplicate/conflicting behavior, Ruby LSP disables some features when a Sorbet codebase is detected, with the intention that Sorbet can provide better accuracy.</p> <h3 id="gem-installation-locations-and-permissions"> <a href="#gem-installation-locations-and-permissions" class="anchor-heading" aria-labelledby="gem-installation-locations-and-permissions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Gem installation locations and permissions </h3> <p>To launch the Ruby LSP server, the <code class="language-plaintext highlighter-rouge">ruby-lsp</code> gem must be installed. And in order to automatically index your project’s dependencies, they must also be installed so that we can read, parse and analyze their source files. The <code class="language-plaintext highlighter-rouge">ruby-lsp</code> gem is installed via <code class="language-plaintext highlighter-rouge">gem install</code> (using RubyGems). The project dependencies are installed via <code class="language-plaintext highlighter-rouge">bundle install</code> (using Bundler).</p> <p>If you use a non-default path to install your gems, please remember that RubyGems and Bundler require separate configurations to achieve that.</p> <p>For example, if you configure <code class="language-plaintext highlighter-rouge">BUNDLE_PATH</code> to point to <code class="language-plaintext highlighter-rouge">vendor/bundle</code> so that gems are installed inside the same directory as your project, <code class="language-plaintext highlighter-rouge">bundle install</code> will automatically pick that up and install them in the right place. But <code class="language-plaintext highlighter-rouge">gem install</code> will not as it requires a different setting to achieve it.</p> <p>You can apply your preferred installed locations for RubyGems by using the <code class="language-plaintext highlighter-rouge">~/.gemrc</code> file. In that file, you can decide to either install it with <code class="language-plaintext highlighter-rouge">--user-install</code> or select a specific installation directory with <code class="language-plaintext highlighter-rouge">--install-dir</code>.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">gem</span><span class="pi">:</span> <span class="s">--user-install</span>
<span class="c1"># Or</span>
<span class="na">gem</span><span class="pi">:</span> <span class="s">--install-dir /my/preferred/path/for/gem/install</span>
</code></pre></div></div> <p>One scenario where this is useful is if the user doesn’t have permissions for the default gem installation directory and <code class="language-plaintext highlighter-rouge">gem install</code> fails. For example, when using the system Ruby on certain Linux distributions.</p> <blockquote class="note"> <p>Using non-default gem installation paths may lead to other integration issues with version managers. For example, for Ruby 3.3.1 the default <code class="language-plaintext highlighter-rouge">GEM_HOME</code> is <code class="language-plaintext highlighter-rouge">~/.gem/ruby/3.3.0</code> (without the patch part of the version). However, <code class="language-plaintext highlighter-rouge">chruby</code> (and potentially other version managers) override <code class="language-plaintext highlighter-rouge">GEM_HOME</code> to include the version patch resulting in <code class="language-plaintext highlighter-rouge">~/.gem/ruby/3.3.1</code>. When you install a gem using <code class="language-plaintext highlighter-rouge">gem install --user-install</code>, RubyGems ignores the <code class="language-plaintext highlighter-rouge">GEM_HOME</code> override and installs the gem inside <code class="language-plaintext highlighter-rouge">~/.gem/ruby/3.3.0</code>. This results in executables not being found because <code class="language-plaintext highlighter-rouge">chruby</code> modified the <code class="language-plaintext highlighter-rouge">PATH</code> to only include executables installed under <code class="language-plaintext highlighter-rouge">~/.gem/ruby/3.3.1</code>.</p> <p>Similarly, the majority of version managers don’t read your <code class="language-plaintext highlighter-rouge">~/.gemrc</code> configurations. If you use a custom installation with <code class="language-plaintext highlighter-rouge">--install-dir</code>, it’s unlikely that the version manager will know about it. This may result in the gem executables not being found.</p> <p>Incompatibilities between RubyGems and version managers like this one are beyond the scope of the Ruby LSP and should be reported either to RubyGems or the respective version manager.</p> </blockquote> <h3 id="developing-on-containers"> <a href="#developing-on-containers" class="anchor-heading" aria-labelledby="developing-on-containers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developing on containers </h3> <p>See the <a href="vscode-extension#developing-on-containers">documentation</a>.</p> <h2 id="diagnosing-the-problem"> <a href="#diagnosing-the-problem" class="anchor-heading" aria-labelledby="diagnosing-the-problem"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Diagnosing the problem </h2> <p>Many activation issues are specific to how your development environment is configured. If you can reproduce the problem you are seeing, including information about these steps is the best way to ensure that we can fix the issue in a timely manner. Please include the steps taken to diagnose in your bug report.</p> <h3 id="check-if-the-server-is-running"> <a href="#check-if-the-server-is-running" class="anchor-heading" aria-labelledby="check-if-the-server-is-running"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Check if the server is running </h3> <p>Check the <a href="https://github.com/Shopify/ruby-lsp/blob/main/vscode/extras/ruby_lsp_status_center.png">status center</a>. Does the server status say it’s running? If it is running, but you are missing certain features, please check our <a href="index#general-features">features documentation</a> to ensure we already added support for it.</p> <p>If the feature is listed as fully supported, but not working for you, report <a href="https://github.com/Shopify/ruby-lsp/issues/new/choose">an issue</a> so that we can assist.</p> <h3 id="check-the-vs-code-output-tab"> <a href="#check-the-vs-code-output-tab" class="anchor-heading" aria-labelledby="check-the-vs-code-output-tab"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Check the VS Code output tab </h3> <p>Many of the activation steps taken are logged in the <code class="language-plaintext highlighter-rouge">Ruby LSP</code> channel of VS Code’s <code class="language-plaintext highlighter-rouge">Output</code> tab. Check the logs to see if any entries hint at what the issue might be.</p> <p>Did the extension select your preferred shell?</p> <p>Did it select your preferred version manager? You can define which version manager to use with the <code class="language-plaintext highlighter-rouge">"rubyLsp.rubyVersionManager"</code> setting.</p> <p>No output in the <code class="language-plaintext highlighter-rouge">Ruby LSP</code> channel? Check the <code class="language-plaintext highlighter-rouge">Extension Host</code> channel for any errors related to extension startup.</p> <h3 id="enable-logging"> <a href="#enable-logging" class="anchor-heading" aria-labelledby="enable-logging"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Enable logging </h3> <p>You can enable logging to the VS Code output tab, <a href="contributing#tracing-lsp-requests-and-responses">as described in the Contributing</a> docs.</p> <h3 id="environment-activation-failed"> <a href="#environment-activation-failed" class="anchor-heading" aria-labelledby="environment-activation-failed"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Environment activation failed </h3> <p>We listed version manager related information and tips in this <a href="version-managers">documentation</a>.</p> <h3 id="my-preferred-version-manager-is-not-supported"> <a href="#my-preferred-version-manager-is-not-supported" class="anchor-heading" aria-labelledby="my-preferred-version-manager-is-not-supported"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> My preferred version manager is not supported </h3> <p>We default to supporting the most common version managers, but that may not cover every single tool available. For these cases, we offer custom activation support. More context in the version manager <a href="version-managers#custom-activation">documentation</a>.</p> <h3 id="try-to-run-the-ruby-activation-manually"> <a href="#try-to-run-the-ruby-activation-manually" class="anchor-heading" aria-labelledby="try-to-run-the-ruby-activation-manually"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Try to run the Ruby activation manually </h3> <p>If the extension is failing to activate the Ruby environment, try running the same command manually in your shell to see if the issue is exclusively related with the extension. The exact command used for activation is printed to the output tab.</p> <h3 id="try-booting-the-server-manually"> <a href="#try-booting-the-server-manually" class="anchor-heading" aria-labelledby="try-booting-the-server-manually"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Try booting the server manually </h3> <p>If the Ruby environment seems to activate properly, but the server won’t boot, try to launch is manually from the terminal with</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Do not use bundle exec</span>
ruby-lsp
</code></pre></div></div> <p>Is there any extra information given from booting the server manually? Or does it only fail when booting through the extension?</p> <h2 id="indexing"> <a href="#indexing" class="anchor-heading" aria-labelledby="indexing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Indexing </h2> <p>When Ruby LSP starts, it attempts to index your code as well as your dependencies as described in <a href="index#configuring-code-indexing">Configuring code indexing</a>.</p> <p>In rare cases, Ruby LSP will encounter an error which prevents indexing from completing, which will result in incomplete information in the editor.</p> <p>Firstly, ensure that you are using the latest release of the <code class="language-plaintext highlighter-rouge">ruby-lsp</code> gem, as the problem may have been already fixed.</p> <p>To diagnose the particular file(s) causing a problem, run <code class="language-plaintext highlighter-rouge">ruby-lsp-check</code>. Please log an issue so that we can address it. If the code is not open source then please provide a minimal reproduction.</p> <p>In the meantime, you can <a href="index#configuring-code-indexing">configure Ruby LSP to ignore a particular gem or file for indexing</a>.</p> <h2 id="after-troubleshooting"> <a href="#after-troubleshooting" class="anchor-heading" aria-labelledby="after-troubleshooting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> After troubleshooting </h2> <p>If after troubleshooting the Ruby LSP is still not initializing properly, please report an issue <a href="https://github.com/Shopify/ruby-lsp/issues/new/choose">here</a> so that we can assist in fixing the problem. Remember to include the steps taken when trying to diagnose the issue.</p> <hr> <h2 class="text-delta">Table of contents</h2> <ul> <li> <a href="/ruby-lsp/version-managers.html">Version Managers</a> </li> </ul> </main> <hr> <footer> <div class="d-md-none mt-4 fs-2"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
